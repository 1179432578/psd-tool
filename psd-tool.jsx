/*var dlg = new Window('dialog', 'Alert Box Builder'); dlg.frameLocation = [100,100];dlg.show();*///$.level = 1var dlg = new Window('dialog', 'Alert Box Builder', [100,100,480,490]);dlg.size = [400, 400];dlg.btnPnl = dlg.add('panel', [0, 0, 480, 490], 'Build it'); dlg.btnPnl.showInfoBtn = dlg.btnPnl.add('button', [0, 200, 50, 250], 'showInfo');dlg.btnPnl.testBtn = dlg.btnPnl.add('button', [0, 30, 50, 80], 'Test');dlg.btnPnl.buildBtn = dlg.btnPnl.add('button', [0, 100, 50, 50], 'Build');dlg.btnPnl.closeBtn = dlg.btnPnl.add('button', [0, 300, 50, 350], 'CLOSE');/*close dialog */function exitBtnOnClick(){    dlg.close (0);}dlg.btnPnl.closeBtn.onClick = exitBtnOnClick;/*is artLayers/layerSets needed copy*/var visibleArtLayer;function isVisibleArtLayer(obj){    //has artlayer    if(obj.artLayers){        for(var i=0; i< obj.artLayers.length; i++){            //artLayer is visible             if(obj.artLayers[i].visible){                visibleArtLayer = obj.artLayers[i];                return ;            }        }    }    //has layerSets    if(obj.layerSets){        for(var i=0; i<obj.LayerSets.length; i++){            isVisibleArtLayer(obj.LayerSets[i]);            if(visibleArtLayer){                return;            }        }   }}function needCopy(obj){    isExistVisibleArtLayer(obj);    if(visibleArtLayer){        visibleArtLayer = null;        return true;    }    else{        return false;    }}var docNew;//new doucumentvar doc;//old document/*copy visible items to new document*/function copyDocument(obj, parentObj){    //copy artLayer    if(obj.artLayers){        for(var i=0; i<obj.artLayers.length; i++){            var artLayer = obj.artLayers[i];                         //if it is not visible then skip it            if(!artLayer.visible) continue;                      app.activeDocument = doc;//active it beacuse we will copy from it            var newArtLayer = artLayer.duplicate(parentObj, ElementPlacement.PLACEATEND);            app.activeDocument = docNew;//active it beacuse we will copy to it            newArtLayer.name = artLayer.name;        }    }    //copy layerSet    if(obj.layerSets){        for(var i=obj.layerSets.length-1; i>=0; i--){            var layerSet = obj.layerSets[i];                         //if it is not visible then skip it            if(!layerSet.visible) continue;                       //if new document exist the layerSet then don't add new layerSet           try{               //if the layerSet is not exist then it will throw execption               parentObj.layerSets.getByName(layerSet.name)           }           catch(e){               var newLayerSet = parentObj.layerSets.add();               newLayerSet.name = layerSet.name;           }          finally{              copyDocument(layerSet, parentObj.layerSets.getByName(layerSet.name));          }                   }    }}/*show document infomation*/function showInfoBtnOnClick(){    var docCount = app.documents.length;//psd files count    doc = app.documents[0];//first psd file    //var fullName = doc.fullName;    var name = doc.name;    var width = doc.width;    var height = doc.height;    var resolution = doc.resolution;    alert ("psdCount:" + width,  "infomation");        /*create a new psd file*/    docNew = app.documents.add(width, height, resolution, name)         /*copy old document to new document*/    for(var i=0; i<docCount; i++){        doc = app.documents[i];        copyDocument(doc, docNew);    }        alert ("finish");}dlg.btnPnl.showInfoBtn.onClick = showInfoBtnOnClick;function cancelBtnOnClick(){    var docRef = app.documents[0]    app.activeDocument = docRef        app.activeDocument = docRef    docRef.layerSets.getByName("home").layerSets.getByName("background").artLayers.getByName("1").duplicate(docRef.layerSets.getByName("home"),    ElementPlacement.PLACEATEND)        docRef.layerSets.getByName("home").layerSets.getByName("background").artLayers.getByName("1").duplicate(layerSetRef,    ElementPlacement.PLACEATEND)}dlg.btnPnl.testBtn.onClick = cancelBtnOnClick;dlg.show();