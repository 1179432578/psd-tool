/*author : lewis  *data : 6/2/2016  *function : check psd   *///debug  mode//$.level = 1//layout of dialog var dlg = new Window('dialog', 'PSD CHECK');dlg.location = [100, 100];dlg.size = [300, 400];dlg.btnPnl = dlg.add('panel', [0, 0, 300, 400], 'CHECK'); dlg.btnPnl.checkBtn = dlg.btnPnl.add('button', [20, 20, 70, 70], 'CHECK');//check psd buttondlg.btnPnl.closeBtn = dlg.btnPnl.add('button', [230, 20, 280, 70], 'CLOSE');//close dialog buttondlg.btnPnl.editText = dlg.btnPnl.add('edittext', [0, 100, 300, 400], 'error:\n', {multiline:true});var log = dlg.btnPnl.editText;//error log/*just close dialog and the merge will not be stoped */function closeBtnOnClick(){    dlg.close (0);}dlg.btnPnl.closeBtn.onClick = closeBtnOnClick;var doc;//document that will be checked//规则1:最顶层目录只能有一个function checkR1(){    if(doc.layerSets.length > 1){        log.text += "规则1:最顶层目录只能有一个\n";   }} //rule2:psd name should  be equal with "home"/"selection" and so on //规则2:最顶层目录名应该是home/selection/map/spa/makeup/dress/show function checkR2(){    var result = false;    var TOPNAME = ["home", "selection", "map"];    var topName = doc.layerSets[0].name;    for(var i=0; i<TOPNAME.length; i++){        if(topName == TOPNAME[i]){            result = true;        }    }    if(!result){        log.text += "规则2:最顶层目录名应该是home/selection/map/spa/makeup/dress/show\n";    }}//规则3：目录名不要包含大写字母，目录名最后一个字符不要是s或者空格function cr3(layerSet){    //大写检查   for(var i=0; i<layerSet.name.length; i++){       if(layerSet.name[i] >= 'A' && layerSet.name[i]<= 'Z'){           log.text += ("规则3：目录名不要包含大写字母" + layerSet.name + '\n');       }       }    //检查最后一个字符是否是s还是空格    if((layerSet.name != 'dress' && layerSet.name[layerSet.name.length-1] == 's') ||         layerSet.name[layerSet.name.length-1] == ' '){             log.text += ("规则3：目录名最后一个字符不要是s或者空格" + layerSet.name + '\n');    }        //递归检查子目录    for(var i=0; i<layerSet.layerSets.length; i++){        cr3(layerSet.layerSets[i]);    }}/*半匹配 earring与earing就是半匹配，earring与earsing也是半匹配  *一个单词有部分字符(一半以上)在另一个单词中找到就是半匹配  */function isHalfMatch(w1, w2){    var matchNum = 0;     for(var i=0; i<w1.length; i++){        var c = w1[i];        for(var j=0; j<w2.length; j++){            if(c == w2[j]){                matchNum++;                break;            }        }    }    if((matchNum > w1.length * 0.8 && w1.length != w2.length) ||         (matchNum > w1.length * 0.8 && matchNum != w1.length && w1.length == w2.length)){        return true;    }    return false;}//对dress场景的psd进行检查function checkDress(layerSet){    //检查dress目录    var DRESS = ["dress up layer", "eyebrow", "model"];    if(layerSet.layerSets.length !=3){        log.text += "dress规则1.1：目录个数不对，dress目录下应该包含dress up layer/eyebrow/model三个目录\n";    }        var result = 0;    for(var i=0; i<layerSet.layerSets.length; i++){        for(var j=0; j<DRESS.length; j++){            if(layerSet.layerSets[i].name == DRESS[j]){                result++;                break;            }        }    }    if(result !=3){            log.text += "dress规则1.2：目录名不匹配，dress目录下应该包含dress up layer/eyebrow/model三个目录\n";    }        //检查dress up layer目录    var DRESSUPLAYER = ["headwear", "earring", "hair", "necklace", "bracelet", "handstuff", "shoe"];    layerSet = layerSet.layerSets.getByName("dress up layer");//try catch    for(var i=0; i<layerSet.layerSets.length; i++){        var w1 =  layerSet.layerSets[i].name;        for(var j=0; j<DRESSUPLAYER.length; j++){            var w2 = DRESSUPLAYER[j];            if(isHalfMatch(w1, w2)){                  log.text += ("dress规则1.3：目录名不匹配," + w2 + "!=" + w1 + "\n");                  break;            }             }    }}//对makeup场景的psd进行检查function checkMakeup(layerSet){    //检查smear layer目录    var SMEARLAYER = ["eyebrow", "eyelash", "eyeliner", "blusher", "eyeshadow", "lipstick"];    var smearLayerSet;    try{        smearLayerSet = layerSet.layerSets.getByName("smear layer");    }    catch(e){         log.text += "makeup规则1.1：smear layer目录不存在\n";    }        if(smearLayerSet != undefined){        var subLayerSet;        for(var i=0; i<SMEARLAYER.length; i++){             try{                 subLayerSet = smearLayerSet.getByName(SMEARLAYER[i]);            }            catch(e){                log.text += ("makeup规则1.2：smear layer目录下不存在" + SMEARLAYER[i] +"目录\n");            }        }    }       }function checkR3(){    for(var i=0; i<doc.layerSets.length; i++){        cr3(doc.layerSets[i]);    }}   /*check document*/function checkBtnOnClick(){    var docCount = app.documents.length;//documents count    if(docCount <= 0 ){return;}        //get document infomation    doc = app.documents[0];//get check document    /*var name = doc.name;    var width = doc.width;    var height = doc.height;    var resolution = doc.resolution;*/        //check psd    checkR1();    checkR2();    checkR3();    if(doc.layerSets[0].name == "dress"){        checkDress(doc.layerSets[0]);    }    else(doc.layerSets[0].name == "makeup"){        checkMakeup(doc.layerSets[0]);    }}dlg.btnPnl.checkBtn.onClick = checkBtnOnClick;//finally show dialogdlg.show();